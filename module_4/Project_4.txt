4.1 
База данных содержит список аэропортов практически всех крупных городов России. В большинстве городов есть только один аэропорт. Исключение составляет:

SELECT DISTINCT a.city
FROM dst_project.airports a
GROUP BY a.city
HAVING count(a.airport_code) > 1
ORDER BY 1



4.2
1) Таблица рейсов содержит всю информацию о прошлых, текущих и запланированных рейсах. Сколько всего статусов для рейсов определено в таблице?

SELECT count(DISTINCT f.status)
FROM dst_project.flights f


2) Какое количество самолетов находятся в воздухе на момент среза в базе (статус рейса «самолёт уже вылетел и находится в воздухе»)

SELECT count(f.aircraft_code)
FROM dst_project.flights f
WHERE f.status = 'Departed'


3) Места определяют схему салона каждой модели. Сколько мест имеет самолет модели 773 (Boeing 777-300)?

SELECT count(DISTINCT s.seat_no)
FROM dst_project.aircrafts a
JOIN dst_project.seats s ON a.aircraft_code = s.aircraft_code
WHERE a.model = 'Boeing 777-300'


4) Сколько состоявшихся (фактических) рейсов было совершено между 1 апреля 2017 года и 1 сентября 2017 года?

SELECT count(f.flight_id)
FROM dst_project.flights f
WHERE f.actual_arrival BETWEEN '2017-04-01' AND '2017-09-01'
  AND f.status = 'Arrived'



4.3
1) Сколько всего рейсов было отменено по данным базы?

SELECT count(f.flight_id)
FROM dst_project.flights f
WHERE f.status = 'Cancelled'


2) Сколько самолетов моделей типа Boeing, Sukhoi Superjet, Airbus находится в базе авиаперевозок?

а) Boeing
SELECT count(a.aircraft_code)
FROM dst_project.aircrafts a
WHERE to_tsvector(a.model) @@ to_tsquery('Boeing')

б) Sukhoi Superjet
SELECT count(a.aircraft_code)
FROM dst_project.aircrafts a
WHERE to_tsvector(a.model) @@ to_tsquery('Sukhoi+Superjet')

в) Airbus
SELECT count(a.aircraft_code)
FROM dst_project.aircrafts a
WHERE a.model like 'Airbus%'


3) В какой части (частях) света находится больше аэропортов? 
Ответ: Europe, Asia


SELECT a.timezone world,
       count(a.airport_code) number
FROM dst_project.airports a
GROUP BY 1
UNION ALL
SELECT 'total_Asia' world,
                    count(a.airport_code) number
FROM dst_project.airports a
WHERE a.timezone like 'Asia%'
UNION ALL
SELECT 'total_Europe' world,
                      count(a.airport_code) number
FROM dst_project.airports a
WHERE a.timezone like 'Europe%'
ORDER BY 2 DESC


4) У какого рейса была самая большая задержка прибытия за все время сбора данных? 
Ответ: 157571

SELECT f.flight_id,
       f.actual_arrival-f.scheduled_arrival time_interval
FROM dst_project.flights f
WHERE actual_arrival IS NOT NULL
ORDER BY 2 DESC
LIMIT 1



4.4
1) Когда был запланирован самый первый вылет, сохраненный в базе данных? 
Ответ: 14.08.2016

SELECT f.scheduled_departure::text
FROM dst_project.flights f
ORDER BY 1 ASC


2) Сколько минут составляет запланированное время полета в самом длительном рейсе? 
Ответ: 530

SELECT f.flight_id,
       f.scheduled_arrival - f.scheduled_departure time_interval,
       date_part('day', f.scheduled_arrival - f.scheduled_departure)*24*60 + date_part('hour', f.scheduled_arrival - f.scheduled_departure)*60 + date_part('minute', f.scheduled_arrival - f.scheduled_departure) minutes
FROM dst_project.flights f
ORDER BY 2 DESC
LIMIT 1
